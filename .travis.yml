language: c

os:
  - linux
  - freebsd
  - osx

dist: bionic

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      ./scripts/clang-format.sh;
    elif [[ "$TRAVIS_OS_NAME" = "freebsd" ]]; then
      sudo pkg install -y scons msgpack nss;
    elif [[ "$TRAVIS_OS_NAME" = "osx" ]]; then
      brew update;
      brew install nss nspr scons msgpack;
    fi

addons:
  apt:
    packages:
    - scons
    - libmsgpack-dev
    - libnss3-dev
    - clang-format-3.9

script:
  - scons DEBUG=1 SANITIZE=1
  - export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
  - ./build/ptest/ptest -v
